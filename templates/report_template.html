<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leak Test Report</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
        }
        body {
            font-family: Helvetica, Arial, sans-serif;
            color: #333;
            line-height: 1.5;
        }
        .header {
            text-align: center;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .header h1 {
            color: #0056b3;
            margin: 0;
            font-size: 24px;
        }
        .header p {
            margin: 5px 0 0;
            color: #666;
            font-size: 12px;
        }
        .meta-info {
            width: 100%;
            margin-bottom: 20px;
        }
        .meta-info td {
            padding: 5px;
            vertical-align: top;
        }
        .section-title {
            background-color: #f0f4f8;
            color: #0056b3;
            padding: 8px;
            font-weight: bold;
            border-left: 4px solid #0056b3;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: 12px;
        }
        .data-table th {
            background-color: #f9f9f9;
            font-weight: bold;
            width: 40%;
        }
        .highlight-box {
            background-color: #e6f3ff;
            border: 1px solid #b8daff;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .highlight-box h3 {
            margin-top: 0;
            color: #004085;
            border-bottom: 1px solid #b8daff;
            padding-bottom: 5px;
        }
        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .result-label {
            font-weight: bold;
        }
        .result-value {
            color: #0056b3;
        }
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 10px;
            color: #999;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Engineering Leak Calculation Report</h1>
        <p>Generated by LeakCalcs.io</p>
    </div>

    <table class="meta-info">
        <tr>
            <td>
                <strong>Project Name:</strong> {{ project_name }}<br>
                <strong>Engineer:</strong> {{ engineer_name }}
            </td>
            <td style="text-align: right;">
                <strong>Batch/ID:</strong> {{ batch_number }}<br>
                <strong>Date:</strong> {{ generation_date }}
            </td>
        </tr>
    </table>

    <div class="section-title">Input Parameters</div>
    <table class="data-table">
        <tr>
            <th>Refrigerant Fluid</th>
            <td>{{ inputs.fluid }}</td>
        </tr>
        <tr>
            <th>Leak Rate Input</th>
            <td>{{ inputs.leak_amount }} g/year</td>
        </tr>
        <tr>
            <th>Operating Conditions</th>
            <td>{{ inputs.op_pressure }} {{ inputs.op_pressure_unit }} @ {{ inputs.op_temp }} °{{ inputs.op_temp_unit }}</td>
        </tr>
        <tr>
            <th>Helium Test Conditions</th>
            <td>{{ inputs.he_pressure }} {{ inputs.he_pressure_unit }} @ {{ inputs.he_temp }} °{{ inputs.he_temp_unit }}</td>
        </tr>
        <tr>
            <th>Helium Purity</th>
            <td>{{ inputs.he_purity }}%</td>
        </tr>
    </table>

    {% if inputs.input_method == 'lifetime' %}
    <div class="section-title">Lifespan Analysis</div>
    <table class="data-table">
        <tr>
            <th>System Charge</th>
            <td>{{ inputs.sys_charge }} g</td>
        </tr>
        <tr>
            <th>Target Lifespan</th>
            <td>{{ inputs.lifespan }} years</td>
        </tr>
        <tr>
            <th>Max Allowable Loss</th>
            <td>{{ inputs.max_loss }}%</td>
        </tr>
        <tr>
            <th>Calculated Max Leak Rate</th>
            <td>{{ result.details.calculated_from_lifetime }} g/year</td>
        </tr>
    </table>
    {% endif %}

    <div class="section-title">Calculated Results</div>
    <div class="highlight-box">
        {% if result.mode == 'oda' %}
            <div class="result-row">
                <span class="result-label">Standard Leak Rate (Q_std):</span>
                <span class="result-value">{{ result.q_std }} mbar·l/s</span>
            </div>
            <div class="result-row">
                <span class="result-label">Helium Standard Leak Rate (Q_He_std):</span>
                <span class="result-value">{{ result.q_he_std }} mbar·l/s</span>
            </div>
            <div class="result-row">
                <span class="result-label">Operating Condition Leak Rate (Q_op):</span>
                <span class="result-value">{{ result.q_op }} mbar·l/s</span>
            </div>
        {% else %}
            <div class="result-row">
                <span class="result-label">Working Condition Leak Rate (Q_work):</span>
                <span class="result-value">{{ result.q_work }} mbar·l/s</span>
            </div>
        {% endif %}
        
        <div style="margin-top: 15px; border-top: 1px dashed #b8daff; padding-top: 10px;">
            <div class="result-row" style="font-size: 16px;">
                <span class="result-label">Target Helium Test Leak Rate (Q_He_test):</span>
                <span class="result-value" style="font-weight: bold;">{{ result.q_he_test }} mbar·l/s</span>
            </div>
        </div>
    </div>

    <div class="section-title">Technical Details</div>
    <table class="data-table">
        <tr>
            <th>Calculation Mode</th>
            <td>{{ 'Standard (Room Temp)' if result.mode == 'oda' else 'Customer (Working Temp)' }}</td>
        </tr>
        <tr>
            <th>Correction Factor</th>
            <td>{{ result.details.correction }}</td>
        </tr>
        {% if result.mode == 'oda' %}
        <tr>
            <th>Viscosity Ratio (Gas/He) @ Std</th>
            <td>{{ result.details.k_visc_std }}</td>
        </tr>
        {% else %}
        <tr>
            <th>Viscosity Ratio (Gas/He)</th>
            <td>{{ result.details.k_visc }}</td>
        </tr>
        <tr>
            <th>Pressure Ratio</th>
            <td>{{ result.details.k_press }}</td>
        </tr>
        {% endif %}
    </table>

    <div class="footer">
        This report was automatically generated by LeakCalcs.io on {{ generation_date }}.<br>
        Verify all parameters before use.
    </div>
</body>
</html>
